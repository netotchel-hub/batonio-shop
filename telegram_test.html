<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç Telegram API</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: Arial; padding: 20px; }
        .result { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>–¢–µ—Å—Ç Telegram Mini App</h1>
    
    <button onclick="testApi()">–¢–µ—Å—Ç API —Ç–æ–≤–∞—Ä–æ–≤</button>
    <button onclick="testShopData()">–¢–µ—Å—Ç –¥–∞–Ω–Ω—ã—Ö –º–∞–≥–∞–∑–∏–Ω–∞</button>
    <button onclick="testOrder()">–¢–µ—Å—Ç –∑–∞–∫–∞–∑–∞</button>
    
    <div class="result" id="result">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å...</div>
    
    <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbz7XL5RH_8UHCbeKTq_1W3vOqaS4LnvqPDkFFn9OJ9Rdxz-RHb0IDvzixcjDeirbXzhGg/dev';
    
    function log(msg) {
        document.getElementById('result').innerHTML += '<div>' + msg + '</div>';
        console.log(msg);
    }
    
    async function testApi() {
        try {
            log('üîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º API —Ç–æ–≤–∞—Ä–æ–≤...');
            const url = API_URL + '?action=getProducts';
            log('URL: ' + url);
            
            const response = await fetch(url);
            log('üì¶ –°—Ç–∞—Ç—É—Å: ' + response.status);
            
            const data = await response.json();
            log('‚úÖ –û—Ç–≤–µ—Ç: ' + JSON.stringify(data).substring(0, 200) + '...');
            log('üìä –¢–æ–≤–∞—Ä–æ–≤: ' + (data.products?.length || 0));
            
            if (data.products?.[0]) {
                log('üéØ –ü–µ—Ä–≤—ã–π —Ç–æ–≤–∞—Ä: ' + data.products[0].name);
            }
        } catch (error) {
            log('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
        }
    }
    
    async function testShopData() {
        try {
            log('üîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –º–∞–≥–∞–∑–∏–Ω–∞...');
            const response = await fetch(API_URL + '?action=getShopData');
            const data = await response.json();
            log('‚úÖ –ú–∞–≥–∞–∑–∏–Ω: ' + data.shopName);
            log('üìÖ –î–æ—Å—Ç–∞–≤–∫–∞: ' + data.deliveryInfo);
        } catch (error) {
            log('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
        }
    }
    
    async function testOrder() {
        try {
            log('üîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞–∫–∞–∑...');
            const testData = {
                telegramUserId: 123456,
                customerName: '–¢–µ—Å—Ç',
                phone: '+79123456789',
                city: '–ú–µ–¥–≤–µ–∂—å–µ–≥–æ—Ä—Å–∫',
                street: '–¢–µ—Å—Ç–æ–≤–∞—è',
                house: '1',
                apartment: '1',
                cart: [{id: 1, name: '–¢–µ—Å—Ç', price: 100, quantity: 1, total: 100}],
                totalSum: 100,
                agreeToTerms: true
            };
            
            const url = API_URL + '?action=placeOrder&' + 
                'telegramUserId=' + testData.telegramUserId +
                '&customerName=' + encodeURIComponent(testData.customerName) +
                '&phone=' + encodeURIComponent(testData.phone) +
                '&city=' + encodeURIComponent(testData.city) +
                '&street=' + encodeURIComponent(testData.street) +
                '&house=' + encodeURIComponent(testData.house) +
                '&cart=' + encodeURIComponent(JSON.stringify(testData.cart)) +
                '&totalSum=' + testData.totalSum +
                '&agreeToTerms=true';
            
            log('URL: ' + url.substring(0, 100) + '...');
            
            const response = await fetch(url);
            const data = await response.json();
            
            if (data.success) {
                log('‚úÖ –ó–∞–∫–∞–∑ —É—Å–ø–µ—à–µ–Ω! ID: ' + data.orderId);
            } else {
                log('‚ùå –û—à–∏–±–∫–∞ –∑–∞–∫–∞–∑–∞: ' + data.error);
            }
        } catch (error) {
            log('üí• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ' + error.message);
        }
    }
    
    // –ê–≤—Ç–æ-—Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    window.onload = function() {
        log('ü§ñ Telegram Mini App –∑–∞–≥—Ä—É–∂–µ–Ω');
        log('üì± Platform: ' + (window.Telegram?.WebApp?.platform || '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ'));
        log('üë§ User ID: ' + (window.Telegram?.WebApp?.initDataUnsafe?.user?.id || '–Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω'));
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Telegram
        if (window.Telegram && Telegram.WebApp) {
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
            log('‚úÖ Telegram WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        }
    };
    </script>
</body>
</html>
